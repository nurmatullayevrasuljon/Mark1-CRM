<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mark1 CRM</title>
  <link rel="shortcut icon" href="img/b-logo2.png" type="image/x-icon">

  <link rel="stylesheet" href="vendor/css/bootstrap.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
  <link rel="stylesheet" href="style.css">

</head>

<body>
  <div class="d-flex">

    <!-- SIDEBAR -->
    <aside class="sidebar">
      <h4 class="logo">
        <img src="img/brand-l.png">
      </h4>
      <ul class="nav flex-column">
        <li class="nav-item active" data-target="dashboard">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
            stroke="currentColor" class="svg-icon">
            <path stroke-linecap="round" stroke-linejoin="round"
              d="M6 13.5V3.75m0 9.75a1.5 1.5 0 0 1 0 3m0-3a1.5 1.5 0 0 0 0 3m0 3.75V16.5m12-3V3.75m0 9.75a1.5 1.5 0 0 1 0 3m0-3a1.5 1.5 0 0 0 0 3m0 3.75V16.5m-6-9V3.75m0 3.75a1.5 1.5 0 0 1 0 3m0-3a1.5 1.5 0 0 0 0 3m0 9.75V10.5" />
          </svg>&nbsp;
          Boshqaruv paneli
        </li>
        <li class="nav-item" data-target="selling">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
            stroke="currentColor" class="svg-icon">
            <path stroke-linecap="round" stroke-linejoin="round"
              d="M2.25 8.25h19.5M2.25 9h19.5m-16.5 5.25h6m-6 2.25h3m-3.75 3h15a2.25 2.25 0 0 0 2.25-2.25V6.75A2.25 2.25 0 0 0 19.5 4.5h-15a2.25 2.25 0 0 0-2.25 2.25v10.5A2.25 2.25 0 0 0 4.5 19.5Z" />
          </svg>&nbsp;
          Sotish
        </li>
        <li class="nav-item" data-target="productsSection">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
            stroke="currentColor" class="svg-icon">
            <path stroke-linecap="round" stroke-linejoin="round"
              d="m21 7.5-9-5.25L3 7.5m18 0-9 5.25m9-5.25v9l-9 5.25M3 7.5l9 5.25M3 7.5v9l9 5.25m0-9v9" />
          </svg>&nbsp;
          Mahsulotlar
        </li>
        <li class="nav-item" data-target="daily-sales">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
            stroke="currentColor" class="svg-icon">
            <path stroke-linecap="round" stroke-linejoin="round"
              d="M12 6v12m-3-2.818.879.659c1.171.879 3.07.879 4.242 0 1.172-.879 1.172-2.303 0-3.182C13.536 12.219 12.768 12 12 12c-.725 0-1.45-.22-2.003-.659-1.106-.879-1.106-2.303 0-3.182s2.9-.879 4.006 0l.415.33M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
          </svg>&nbsp;
          Kunlik Savdolar
        </li>
        <li class="nav-item" data-target="debtors">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
            stroke="currentColor" class="svg-icon">
            <path stroke-linecap="round" stroke-linejoin="round"
              d="M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 0 0 2.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 0 0-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75 2.25 2.25 0 0 0-.1-.664m-5.8 0A2.251 2.251 0 0 1 13.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25ZM6.75 12h.008v.008H6.75V12Zm0 3h.008v.008H6.75V15Zm0 3h.008v.008H6.75V18Z" />
          </svg>
          Qarzdorlar
        </li>
        <li class="nav-item" data-target="settings">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
            stroke="currentColor" class="svg-icon">
            <path stroke-linecap="round" stroke-linejoin="round"
              d="M10.343 3.94c.09-.542.56-.94 1.11-.94h1.093c.55 0 1.02.398 1.11.94l.149.894c.07.424.384.764.78.93.398.164.855.142 1.205-.108l.737-.527a1.125 1.125 0 0 1 1.45.12l.773.774c.39.389.44 1.002.12 1.45l-.527.737c-.25.35-.272.806-.107 1.204.165.397.505.71.93.78l.893.15c.543.09.94.559.94 1.109v1.094c0 .55-.397 1.02-.94 1.11l-.894.149c-.424.07-.764.383-.929.78-.165.398-.143.854.107 1.204l.527.738c.32.447.269 1.06-.12 1.45l-.774.773a1.125 1.125 0 0 1-1.449.12l-.738-.527c-.35-.25-.806-.272-1.203-.107-.398.165-.71.505-.781.929l-.149.894c-.09.542-.56.94-1.11.94h-1.094c-.55 0-1.019-.398-1.11-.94l-.148-.894c-.071-.424-.384-.764-.781-.93-.398-.164-.854-.142-1.204.108l-.738.527c-.447.32-1.06.269-1.45-.12l-.773-.774a1.125 1.125 0 0 1-.12-1.45l.527-.737c.25-.35.272-.806.108-1.204-.165-.397-.506-.71-.93-.78l-.894-.15c-.542-.09-.94-.56-.94-1.109v-1.094c0-.55.398-1.02.94-1.11l.894-.149c.424-.07.765-.383.93-.78.165-.398.143-.854-.108-1.204l-.526-.738a1.125 1.125 0 0 1 .12-1.45l.773-.773a1.125 1.125 0 0 1 1.45-.12l.737.527c.35.25.807.272 1.204.107.397-.165.71-.505.78-.929l.15-.894Z" />
            <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
          </svg>

          Sozlamalar
        </li>
      </ul>
    </aside>
    <!-- MOBILE BOTTOM NAV -->
    <nav class="mobile-bottom-nav">
      <button data-target="dashboard">
        <i class="bi bi-house"></i>
        <span class="border">Asosiy</span>
      </button>
      <button data-target="productsSection">
        <i class="bi bi-box"></i>
        <span>Mahsulotlar</span>
      </button>
      <button data-target="selling">
        <i class="bi bi-cart"></i>
        <span>Sotuvlar</span>
      </button>
      <button data-target="daily-sales">
        <i class="bi bi-receipt"></i>
        <span>Tranz.</span>
      </button>
      <button data-target="debtors">
        <i class="bi bi-people"></i>
        <span>Qarzlar</span>
      </button>
      <button data-target="settings">
        <i class="bi bi-grid"></i>
        <span>Menu</span>
      </button>

    </nav>

    <!-- MAIN -->
    <main class="content">
      <div class="topbar">
        <h5 id="pageTitle">Dashboard</h5>
        <div class="top-actions">
          <div class="profile-wrapper">
            <div class="profile-trigger" id="profileTrigger">
              <div class="profile-avatar-wrapper">
                <img id="topbarAvatar" class="profile-avatar" alt="Avatar">
                <div id="topbarAvatarFallback" class="profile-avatar-fallback">AU</div>
                <div class="notification-dot"></div>
              </div>
              <div class="profile-info">
                <span class="profile-name" id="profileName">Admin User</span>
                <span class="profile-store" id="profileEmail">Your Company Inc</span>
              </div>
              <svg class="profile-dropdown-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
              </svg>
            </div>

            <div class="profile-dropdown" id="profileDropdown">
              <div class="profile-dropdown-header">
                <div class="profile-dropdown-avatar-wrapper">
                  <img id="dropdownAvatar" class="profile-dropdown-avatar" alt="Avatar">
                  <div id="dropdownAvatarFallback" class="profile-dropdown-avatar-fallback">AU</div>
                  <div class="profile-dropdown-info">
                    <h4 id="dropdownName">Admin User</h4>
                    <p id="dropdownEmail">admin@crm.example.com</p>
                    <p id="dropdownPhone" style="font-size: 12px; margin-bottom: 6px;">+998 90 123 45 67</p>
                    <span class="profile-badge" id="dropdownRole">Boshqaruv</span>
                  </div>
                </div>

                <div class="profile-dropdown-stats">
                  <div class="stat-item">
                    <span class="stat-value" id="statCustomers">156</span>
                    <span class="stat-label">Mijozlar</span>
                  </div>
                  <div class="stat-item">
                    <span class="stat-value" id="statDeals">89</span>
                    <span class="stat-label">Bitimlar</span>
                  </div>
                  <div class="stat-item">
                    <span class="stat-value" id="statToday">0</span>
                    <span class="stat-label" id="todayLabel">Bugun</span>
                  </div>
                </div>
              </div>

              <div class="profile-dropdown-menu">
                <a class="dropdown-item" data-page="profile">
                  <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                  </svg>
                  Shaxsiy profil
                </a>

                <a class="dropdown-item" data-page="settings">
                  <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z">
                    </path>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                  </svg>
                  Sozlamalar
                </a>

                <a class="dropdown-item" data-page="dashboard">
                  <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6">
                    </path>
                  </svg>
                  Dashboard
                </a>

                <div class="dropdown-divider"></div>

                <a class="dropdown-item logout" id="logoutBtn">
                  <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1">
                    </path>
                  </svg>
                  Chiqish
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Overlay -->
      <div class="dropdown-overlay" id="dropdownOverlay"></div>

      <!-- Overlay -->
      <div class="dropdown-overlay" id="dropdownOverlay"></div>

      <div class="dropdown-overlay" id="dropdownOverlay"></div>

      <!-- DASHBOARD -->
      <section id="dashboard" class="section active">

        <div class="row">
          <!-- 1. OYLIK DAROMAD -->
          <div class="col-md-3 col-sm-6">
            <div class="card-box">
              <small class="counter-smal">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                  stroke="currentColor" class="svg-icon">
                  <path stroke-linecap="round" stroke-linejoin="round"
                    d="M12 6v12m-3-2.818.879.659c1.171.879 3.07.879 4.242 0 1.172-.879 1.172-2.303 0-3.182C13.536 12.219 12.768 12 12 12c-.725 0-1.45-.22-2.003-.659-1.106-.879-1.106-2.303 0-3.182s2.9-.879 4.006 0l.415.33M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
                </svg>
                Oylik tushum
              </small>
              <h3 class="counter" data-key="totalRevenue" data-count="0" data-last-value="0">
                0 <small>UZS</small>
              </h3>
              <small class="counter-change" id="monthlyRevenueChange">Hali sotuv boshlanmagan</small>
            </div>
          </div>

          <!-- 2. KUNLIK DAROMAD -->
          <div class="col-md-3 col-sm-6">
            <div class="card-box">
              <small class="counter-smal">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                  stroke="currentColor" class="svg-icon">
                  <path stroke-linecap="round" stroke-linejoin="round"
                    d="M3.75 3v11.25A2.25 2.25 0 0 0 6 16.5h2.25M3.75 3h-1.5m1.5 0h16.5m0 0h1.5m-1.5 0v11.25A2.25 2.25 0 0 1 18 16.5h-2.25m-7.5 0h7.5m-7.5 0-1 3m8.5-3 1 3m0 0 .5 1.5m-.5-1.5h-9.5m0 0-.5 1.5M9 11.25v1.5M12 9v3.75m3-6v6" />
                </svg>

                Kundalik savdo
              </small>
              <h3 class="daily-c" id="dailySalesCounter">0 <small>UZS</small></h3>
              <small class="counter-change" id="dailySalesChange">Bugun savdo yo'q</small>
            </div>
          </div>

          <!-- 3. OYLIK FOYDA (YANGI) -->
          <div class="col-md-3 col-sm-6">
            <div class="card-box">
              <small class="counter-smal">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                  stroke="currentColor" class="svg-icon">
                  <path stroke-linecap="round" stroke-linejoin="round"
                    d="M2.25 18 9 11.25l4.306 4.306a11.95 11.95 0 0 1 5.814-5.518l2.74-1.22m0 0-5.94-2.281m5.94 2.28-2.28 5.941" />
                </svg>

                Oylik foyda
              </small>
              <h3 class="counter" data-key="totalProfit" data-count="0" data-last-value="0">
                0 <small>UZS</small>
              </h3>
              <small class="text-success">Kelgan va sotish narxi farqi</small>
            </div>
          </div>

          <!-- 4. INVENTAR BALANSI -->
          <div class="col-md-3 col-sm-6">
            <div class="card-box">
              <small class="counter-smal"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                  stroke-width="1.5" stroke="currentColor" class="svg-icon">
                  <path stroke-linecap="round" stroke-linejoin="round"
                    d="m21 7.5-9-5.25L3 7.5m18 0-9 5.25m9-5.25v9l-9 5.25M3 7.5l9 5.25M3 7.5v9l9 5.25m0-9v9" />
                </svg> Inventar balansi
              </small>
              <h3 class="counter" data-count="4500600">
                0 <small>UZS</small>
              </h3>
              <small class="text-muted">Umumiy stok qiymati</small>
            </div>
          </div>
        </div>

        <div class="row mt-4">
          <div class="col-lg-8">
            <div class="card-box">
              <h6>7 kunlik savdo trendi</h6>
              <canvas id="weeklyChart"></canvas>
            </div>
          </div>
          <div class="col-lg-4">
            <div class="card-box">
              <h6>Kunlik daromad</h6>
              <canvas id="dailyChart"></canvas>
            </div>
          </div>
        </div>

        <div class="row mt-4">
          <div class="col-lg-6">
            <div class="overdue-wrapper">
              <h3 class="overdue-title">Muddati o'tgan to'lovlar</h3>
              <p class="overdue-subtitle">Shoshilinch e'tibor talab etiladi</p>

              <div id="overdueCards"></div>
            </div>
          </div>
          <div class="col-lg-6">
            <section class="low-stock-section">
              <div class="section-header">
                <span class="icon">‚ö†Ô∏è</span>
                <div>
                  <h4>Kam zaxiralar haqida ogohlantirish</h4>
                  <p>Qayta buyurtma berish darajasidan past mahsulotlar</p>
                </div>
              </div>

              <div id="lowStockContainer" class="low-stock-list"></div>
            </section>
          </div>
        </div>

      </section>

      <!-- SELLING SECTION -->
      <section id="selling" class="section">
        <div id="saleAlert" class="sale-alert hidden"></div>
        <div class="d-flex justify-content-between align-items-center mb-4">
          <div>
            <h2>
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                stroke="currentColor" class="svg-icon">
                <path stroke-linecap="round" stroke-linejoin="round"
                  d="M2.25 18.75a60.07 60.07 0 0 1 15.797 2.101c.727.198 1.453-.342 1.453-1.096V18.75M3.75 4.5v.75A.75.75 0 0 1 3 6h-.75m0 0v-.375c0-.621.504-1.125 1.125-1.125H20.25M2.25 6v9m18-10.5v.75c0 .414.336.75.75.75h.75m-1.5-1.5h.375c.621 0 1.125.504 1.125 1.125v9.75c0 .621-.504 1.125-1.125 1.125h-.375m1.5-1.5H21a.75.75 0 0 0-.75.75v.75m0 0H3.75m0 0h-.375a1.125 1.125 0 0 1-1.125-1.125V15m1.5 1.5v-.75A.75.75 0 0 0 3 15h-.75M15 10.5a3 3 0 1 1-6 0 3 3 0 0 1 6 0Zm3 0h.008v.008H18V10.5Zm-12 0h.008v.008H6V10.5Z" />
              </svg>
              Sotuvlar
            </h2>
            <small class="text-muted">Mahsulot sotish va real vaqtda hisobni ko'rish</small>
          </div>
        </div>

        <div class="card mt-4">
          <div class="card-body">
            <h5>üõí Yangi sotuv</h5>

            <div class="row">
              <!-- Mahsulot tanlash -->
              <div class="col-md-4">
                <label class="font-weight-bold">Mahsulot</label>
                <input type="text" id="saleSearch" class="form-control mb-2" placeholder="üîç Mahsulot qidirish...">
                <select id="saleProduct" class="form-control"></select>
              </div>

              <!-- Miqdor -->
              <div class="col-md-3">
                <label id="saleQtyLabel" class="font-weight-bold">Miqdor</label>
                <input type="number" id="saleQty" class="form-control" step="0.01" min="0.01"
                  placeholder="Miqdorni kiriting" />
              </div>

              <!-- Narx (disabled) -->
              <div class="col-md-3">
                <label class="font-weight-bold">Narx</label>
                <input type="text" id="salePrice" class="form-control" disabled>
              </div>

              <!-- To'lov turi tugmalari -->
              <div class="col-md-2 d-flex align-items-end">
                <div class="btn-group w-100">
                  <button class="btn btn-success" id="addSaleCash" title="Naqd to'lov">
                    üíµ Naqd
                  </button>
                  <button class="btn btn-info" id="addSaleCard" title="Karta to'lov">
                    üí≥ Karta
                  </button>
                </div>
              </div>
            </div>

            <hr class="my-4">

            <!-- Bugungi sotilgan mahsulotlar jadvali -->
            <div class="d-flex justify-content-between align-items-center mb-3">
              <h6 class="mb-0">üßæ Bugungi sotilgan mahsulotlar</h6>
              <small class="text-muted">Real vaqt rejimida yangilanadi</small>
            </div>

            <div class="table-responsive">
              <table class="table table-sm table-hover">
                <thead class="thead-light">
                  <tr>
                    <th>Mahsulot</th>
                    <th>Miqdor</th>
                    <th>Narx</th>
                    <th>Jami</th>
                    <th>Vaqt</th> <!-- YANGI -->
                    <th>Harakatlar</th>
                  </tr>
                </thead>
                <tbody id="salesTable"></tbody>
              </table>
            </div>

            <!-- Jami summa -->
            <div class="d-flex justify-content-end mt-3">
              <div class="alert alert-success mb-0 py-2 px-4">
                <strong>Jami daromad: <span id="totalSum" class="h5 mb-0">0 UZS</span></strong>
              </div>
            </div>
            <!-- YANGI SOTUV TUGMASI -->
            <button class="btn btn-success" onclick="startNewSale()" title="Yangi sotuvni boshlash">
              üÜï Yangi Sotuv
            </button>
          </div>
        </div>
      </section>

      <!-- PRODUCTS SECTION -->
      <section id="productsSection" class="section">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <div>
            <h2>Mahsulotlar</h2>
            <small class="text-muted">Mahsulot inventarizatsiyasini boshqarish</small>
          </div>
          <button class="btn btn-info" id="openProductModal">+ Mahsulot qo'shih</button>
        </div>

        <div class="card">
          <div class="card-body">

            <input type="text" id="productSearch" placeholder="Search by name or SKU...">

            <div class="table-responsive">
              <table class="table table-hover align-middle">
                <thead>
                  <tr>
                    <th>Rasm</th>
                    <th>Nomi</th>
                    <th>Turi</th>
                    <th>Narxi</th>
                    <th>Soni</th>
                    <th>Sotuv holati (hafta)</th>
                    <th>Harakatlar</th>
                  </tr>
                </thead>
                <tbody id="productTable"></tbody>
              </table>
            </div>

          </div>
        </div>
      </section>


      <!-- Daily-SALES -->
      <section id="daily-sales" class="section">
        <h2>Kunlik savdo ko'rsatkichlari</h2>
        <p>Tranzaksiyalarni real vaqt rejimida kuzatish va daromadlarni monitoring qilish</p>

        <div class="row">
          <!-- Bugungi daromad card -->
          <div class="col-md-4 mb-3">
            <div class="card p-3">
              <p class="text-muted mb-1">Bugungi daromad</p>
              <div class="daily-counter" id="dailySalesPageCounter" data-last-value="0">0</div>
              <div id="dailySalesPageChange" class="counter-change text-muted">
                Bugun savdo yo'q
              </div>
            </div>
          </div>
          <!-- To'lanmagan qarz -->
          <div class="col-md-3 col-sm-6">
            <div class="card-box">
              <small class="counter-smal">‚ö†Ô∏è To'lanmagan qarz</small>
              <h3 class="counter" data-key="totalDebt" data-count="0">0</h3>
              <div class="debt-count-badge">
                <i class="bi bi-people-fill"></i>
                <span>5</span> ta qarzdor
              </div>
            </div>
          </div>

          <!-- Bugungi tranziksiyalar -->
          <div class="col-md-3 col-sm-6">
            <div class="card-box">
              <small class="counter-smal">üìù Bugungi tranziksiyalar</small>
              <h3 class="tranzik-text" id="totalTransactionsCounter" data-last-value="0">0</h3>
              <small class="text-muted">Sotuvlar soni</small>
            </div>
          </div>
        </div>

        <!-- ===== TRANSACTION JOURNAL ===== -->
        <div class="card mt-4">
          <div class="card-body">
            <div class="d-flex justify-content-between mb-3 align-items-center">
              <h5 class="mb-0">Tranzaksiya jurnali</h5>
              <div class="d-flex gap-2">
                <!-- Filter Select -->
                <select id="transactionFilter" class="form-control form-control-sm" style="width: 150px;">
                  <option value="daily" selected>Kunlik</option>
                  <option value="weekly">Haftalik</option>
                  <option value="monthly">Oylik</option>
                </select>

                <!-- Export Button -->
                <button class="btn btn-sm btn-primary" onclick="exportTransactionsExcel()" id="exportTransactions">
                  üì• Eksport qilish
                </button>
              </div>
            </div>

            <table class="table table-sm table-hover">
              <input type="text" id="transactionSearch" class="form-control form-control-sm tr-input"
                style="width: 200px;" placeholder="Mahsulot nomi bo‚Äòyicha qidirish...">
              <thead>
                <tr>
                  <th>Mahsulot</th>
                  <th>Miqdor</th>
                  <th>Narx</th>
                  <th>Sana / Vaqt</th>
                  <th>To'lov turi</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody id="transactionsTableBody"></tbody>
            </table>
          </div>
        </div>
      </section>
      <!-- Debtors -->
      <section id="debtors" class="section">
        <div class="container">
          <h1>Qarzdorlarni boshqarish</h1>
          <p>To'lov holatini va to'lanmagan qoldiqlarni kuzatib boring</p>

          <div class="stats-container">
            <div class="stat-card overdue">
              <h3>Muddati o'tgan to'lovlar</h3>
              <div class="amount" id="overdueAmount">0 so'm</div>
              <div class="detail"><span id="overdueCount">0</span> ta qarzdor - Shoshilinch e'tibor</div>
            </div>

            <div class="stat-card upcoming">
              <h3>Kelgusi to'lov muddati</h3>
              <div class="amount" id="upcomingAmount">0 so'm</div>
              <div class="detail"><span id="upcomingCount">0</span> ta qarzdor - 7 kun ichida</div>
            </div>

            <div class="stat-card total">
              <h3>Bir oylik undirilgan summa</h3>
              <div class="amount" id="totalAmount">0 so'm</div>
              <div class="detail"><span id="totalCount">0</span> ta qarzdordan undirilgan</div>
            </div>
          </div>

          <div class="filter-tabs">
            <button class="active" data-filter="all">Hammasi</button>
            <button data-filter="overdue">Muddati o'tgan</button>
            <button data-filter="upcoming">Yaqinlashib kelayotgan</button>
            <button data-filter="normal">Oddiy</button>
          </div>

          <div class="search-add-container">
            <div class="search-box">
              <i class="bi bi-search"></i>
              <input type="text" id="searchInput" placeholder="Ism yoki telefon orqali qidirish...">
            </div>
            <button class="btn-add-debt" onclick="openModal()">
              <i class="bi bi-plus-circle"></i> Yangi qarzdor qo'shish
            </button>
          </div>

          <div class="debt-table">
            <div class="table-responsive">
              <table class="table">
                <thead>
                  <tr>
                    <th>Qarzdor</th>
                    <th>Aloqa</th>
                    <th>Qarz summasi</th>
                    <th>Muddati</th>
                    <!-- <th>Kechikish</th> -->
                    <th>Holati</th>
                    <th>Amallar</th>
                  </tr>
                </thead>
                <tbody id="debtorTableBody">
                  <tr>
                    <td colspan="7" style="text-align: center; padding: 3rem;">
                      <i class="bi bi-inbox" style="font-size: 3rem; opacity: 0.3;"></i>
                      <p>Ma'lumotlar yuklanmoqda...</p>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Qarzdor qo'shish modali -->
        <div class="modal-debtors" id="debtorModal">
          <div class="modal-debtors-content">
            <div class="modal-debtors-header">
              <h2>Yangi qarzdor qo'shish</h2>
              <button class="close-modal-debtors" onclick="closeModal()">&times;</button>
            </div>
            <form id="debtorForm" onsubmit="handleSubmit(event)">
              <div class="form-group">
                <label for="debtorName">Qarzdor ismi *</label>
                <input type="text" id="debtorName" required placeholder="Alisher Navoiy"
                  style="text-transform: capitalize;">
              </div>
              <div class="form-group">
                <label for="debtorPhone">Telefon raqami *</label>
                <input type="tel" id="debtorPhone" required placeholder="+998 90 123 45 67" maxlength="9">
              </div>
              <div class="form-group">
                <label for="debtAmount">Qarz summasi (so'm) *</label>
                <input type="number" id="debtAmount" required step="1" min="0" placeholder="50000">
              </div>
              <div class="form-group">
                <label for="debtDate">Qarz olingan sana *</label>
                <input type="date" id="debtDate" required>
              </div>
              <div class="form-group">
                <label for="returnDate">Qaytarish sanasi *</label>
                <input type="date" id="returnDate" required>
              </div>
              <div class="form-group">
                <label for="debtNotes">Eslatmalar</label>
                <textarea id="debtNotes" rows="3" placeholder="Qo'shimcha ma'lumot..."></textarea>
              </div>
              <button type="submit" class="btn-submit">
                <i class="bi bi-check-circle"></i> Qarzdorni saqlash
              </button>
            </form>
          </div>
        </div>

        <!-- SMS modali -->
        <div class="modal-debtors" id="smsModal">
          <div class="modal-debtors-content">
            <div class="modal-debtors-header">
              <h2>SMS eslatma</h2>
              <button class="close-modal-debtors" onclick="closeSmsModal()">&times;</button>
            </div>
            <form id="smsForm" onsubmit="sendSms(event)">
              <div class="form-group">
                <label>Qabul qiluvchi</label>
                <input type="text" id="smsRecipient" readonly>
              </div>
              <div class="form-group">
                <label>Telefon</label>
                <input type="text" id="smsPhone" readonly>
              </div>
              <div class="form-group">
                <label>SMS matni</label>
                <textarea id="smsMessage" rows="5" required></textarea>
              </div>
              <div class="sms-preview">
                <strong>Ko'rinish:</strong>
                <p id="smsPreview"></p>
              </div>
              <button type="submit" class="btn-submit" style="margin-top: 1rem;">
                <i class="bi bi-send"></i> SMS yuborish
              </button>
            </form>
          </div>
        </div>

        <!-- Qarz qo'shish/kamaytirish modali -->
        <div class="modal-debtors" id="adjustDebtModal">
          <div class="modal-debtors-content">
            <div class="modal-debtors-header">
              <h2 id="adjustModalTitle">Qarzni o'zgartirish</h2>
              <button class="close-modal-debtors" onclick="closeAdjustModal()">&times;</button>
            </div>
            <form id="adjustDebtForm" onsubmit="handleAdjustDebt(event)">
              <div class="form-group">
                <label>Qarzdor</label>
                <input type="text" id="adjustDebtorName" readonly>
              </div>
              <div class="form-group">
                <label>Joriy qarz</label>
                <input type="text" id="adjustCurrentDebt" readonly>
              </div>
              <div class="form-group">
                <label id="adjustAmountLabel">Summa (so'm)</label>
                <input type="number" id="adjustAmount" required step="1" min="1" placeholder="15000">
              </div>
              <input type="hidden" id="adjustDebtorId">
              <input type="hidden" id="adjustType">
              <button type="submit" class="btn-submit" id="adjustSubmitBtn">
                <i class="bi bi-check-circle"></i> Tasdiqlash
              </button>
            </form>
          </div>
        </div>
      </section>

      <!-- SETTINGS -->
      <section id="settings" class="section">
        <h4>Sozlamalar</h4>
        <p>Profil va tizim sozlamalari.</p>
        <div class="container">
          <!-- Notification -->
          <div id="notification" class="notification">
            <svg fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd"
                d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                clip-rule="evenodd"></path>
            </svg>
            <span id="notificationText"></span>
          </div>

          <!-- Header -->
          <div class="header">
            <h1>Administrator profili</h1>
            <p>Shaxsiy ma'lumotlaringiz, ruxsatnomalaringiz va sozlamalaringizni boshqaring</p>
          </div>

          <!-- Tabs -->
          <div class="tabs-container">
            <div class="tabs">
              <button class="tab active" onclick="switchTab('info')">Shaxsiy ma'lumot</button>
              <button class="tab" onclick="switchTab('permissions')">Ruxsatnomalar va kirish</button>
              <button class="tab" onclick="switchTab('security')">Xavfsizlik</button>
              <button class="tab" onclick="switchTab('settings')">Sozlamalar</button>
            </div>
          </div>

          <!-- Content -->
          <div class="content-card">
            <!-- Personal Info Tab -->
            <div id="info-content" class="tab-content">
              <div class="content-header">
                <h2>Shaxsiy ma'lumot</h2>
                <p>Profil ma'lumotlaringizni yangilang</p>
              </div>

              <div class="avatar-section">
                <div class="avatar-wrapper">
                  <img id="profileAvatar" class="avatar-img d-none" alt="Avatar" />
                  <div id="avatarFallback" class="avatar">AU</div>
                </div>

                <div class="avatar-actions">
                  <input type="file" id="avatarInput" accept="image/png, image/jpeg, image/gif" hidden />

                  <button onclick="triggerAvatarUpload()">
                    Avatarni o‚Äòzgartirish
                  </button>

                  <p class="text-muted mb-0">JPG, PNG yoki GIF. Max 2MB</p>
                </div>
              </div>

              <div>
                <div class="form-group">
                  <label class="form-label">To'liq ism</label>
                  <div class="input-wrapper">
                    <svg class="input-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                    </svg>
                    <input type="text" id="fullName" class="form-input" placeholder="To'liq ismingizni kiriting">
                  </div>
                  <span id="fullNameError" class="error-message hidden"></span>
                </div>

                <div class="form-group">
                  <label class="form-label">E-pochta manzili</label>
                  <div class="input-wrapper">
                    <svg class="input-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z">
                      </path>
                    </svg>
                    <input type="email" id="email" class="form-input" placeholder="email@example.com">
                  </div>
                  <span id="emailError" class="error-message hidden"></span>
                </div>

                <div class="form-group">
                  <label class="form-label">Telefon raqami</label>
                  <div class="input-wrapper">
                    <svg class="input-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z">
                      </path>
                    </svg>
                    <input type="tel" id="phone" class="form-input" placeholder="+998 (90) 123-45-67">
                  </div>
                  <span id="phoneError" class="error-message hidden"></span>
                </div>

                <div class="form-grid">
                  <div class="form-group">
                    <label class="form-label">Departament</label>
                    <div class="input-wrapper">
                      <svg class="input-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z">
                        </path>
                      </svg>
                      <select id="department" class="form-select">
                        <option value="boshqaruv" selected>Boshqaruv</option>
                        <option value="savdo">Savdo</option>
                        <option value="marketing">Marketing</option>
                        <option value="it">IT</option>
                        <option value="moliya">Moliya</option>
                      </select>
                    </div>
                  </div>

                  <div class="form-group">
                    <label class="form-label">Kompaniya</label>
                    <div class="input-wrapper">
                      <svg class="input-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4">
                        </path>
                      </svg>
                      <input type="text" id="company" class="form-input" placeholder="Kompaniya nomi">
                    </div>
                    <span id="companyError" class="error-message hidden"></span>
                  </div>
                </div>

                <div class="form-footer">
                  <button class="btn-primary" onclick="saveChanges()">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4">
                      </path>
                    </svg>
                    O'zgarishlarni saqlash
                  </button>
                </div>
              </div>
            </div>

            <!-- Permissions Tab -->
            <div id="permissions-content" class="tab-content hidden">
              <div class="content-header">
                <h2>Ruxsatnomalar va kirish</h2>
                <p>Tizimga kirish huquqlaringizni ko'ring</p>
              </div>

              <div class="permission-list">
                <div class="permission-item">
                  <span>Foydalanuvchilarni boshqarish</span>
                  <span class="badge">Faol</span>
                </div>
                <div class="permission-item">
                  <span>Xisobotlarni ko'rish</span>
                  <span class="badge">Faol</span>
                </div>
                <div class="permission-item">
                  <span>Sozlamalarni o'zgartirish</span>
                  <span class="badge">Faol</span>
                </div>
                <div class="permission-item">
                  <span>Ma'lumotlar bazasini boshqarish</span>
                  <span class="badge">Faol</span>
                </div>
              </div>
            </div>

            <!-- Security Tab -->
            <div id="security-content" class="tab-content hidden">
              <div class="content-header">
                <h2>Xavfsizlik sozlamalari</h2>
                <p>Hisobingizni himoya qilish uchun sozlamalar</p>
              </div>

              <div class="security-card">
                <h3>Parolni o'zgartirish</h3>
                <p>Xavfsizlik uchun parolingizni muntazam yangilang</p>
                <button class="btn-secondary">Parolni yangilash</button>
              </div>

              <div class="security-card">
                <h3>Ikki bosqichli autentifikatsiya</h3>
                <p>Qo'shimcha xavfsizlik qatlami qo'shing</p>
                <button class="btn-primary">Yoqish</button>
              </div>
            </div>

            <!-- Settings Tab -->
            <div id="settings-content" class="tab-content hidden">
              <div class="content-header">
                <h2>Tizim sozlamalari</h2>
                <p>Shaxsiy afzalliklaringizni sozlang</p>
              </div>

              <div class="setting-item">
                <div class="setting-info">
                  <h3>Email bildirishnomalar</h3>
                  <p>Muhim yangilanishlar haqida xabardor bo'ling</p>
                </div>
                <label class="toggle-switch">
                  <input type="checkbox" checked>
                  <span class="toggle-slider"></span>
                </label>
              </div>

              <div class="setting-item">
                <div class="setting-info">
                  <h3>Qorong'i rejim</h3>
                  <p>Ko'zlaringiz uchun qulayroq interfeys</p>
                </div>
                <label class="toggle-switch">
                  <input type="checkbox">
                  <span class="toggle-slider"></span>
                </label>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- PRODUCT MODAL - Professional -->
      <div class="modal fade" id="productModal" style="overflow: scroll;">
        <div class="modal-dialog modal-dialog-centered modal-lg">
          <div class="modal-content">
            <form id="productForm">
              <div class="modal-header">
                <h5 class="modal-title">üì¶ Mahsulot qo'shish</h5>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
              </div>

              <div class="modal-body">
                <div class="row">
                  <!-- NAME -->
                  <div class="col-md-6 mb-3">
                    <label class="font-weight-bold">Mahsulot nomi *</label>
                    <input id="productName" class="form-control" required placeholder="Masalan: Olma">
                  </div>

                  <!-- CATEGORY -->
                  <div class="col-md-6 mb-3">
                    <label class="font-weight-bold">Kategoriya *</label>
                    <div class="d-flex gap-2">
                      <select id="productCategory" class="form-control" required></select>
                      <button type="button" class="btn btn-outline-info" id="openCategoryModal"
                        title="Kategoriya qo'shish">
                        +
                      </button>
                    </div>
                  </div>

                  <!-- IMAGE -->
                  <div class="col-md-12 mb-3">
                    <label class="font-weight-bold">Mahsulot rasmi</label>
                    <input type="file" id="productImage" class="form-control" accept="image/*">
                  </div>

                  <!-- COST PRICE (Kelgan narxi) -->
                  <div class="col-md-5 mb-3">
                    <label class="font-weight-bold">Kelgan narxi * <small class="text-muted">(UZS)</small></label>
                    <input type="number" id="productCostPrice" class="form-control" required placeholder="50000" min="0"
                      oninput="calculateProfitPreview()">
                  </div>

                  <!-- SALE PRICE (Sotish narxi) -->
                  <div class="col-md-5 mb-3">
                    <label class="font-weight-bold">Sotish narxi * <small class="text-muted">(UZS)</small></label>
                    <input type="number" id="productPrice" class="form-control" required placeholder="75000" min="0"
                      oninput="calculateProfitPreview()">
                  </div>

                  <!-- CURRENCY -->
                  <div class="col-md-2 mb-3">
                    <label class="font-weight-bold">Valyuta</label>
                    <select id="productCurrency" class="form-control">
                      <option value="UZS" selected>UZS</option>
                      <option value="$">$</option>
                      <option value="‚Ç¨">‚Ç¨</option>
                    </select>
                  </div>

                  <!-- PROFIT PREVIEW (Real-time) -->
                  <div class="col-md-12 mb-3">
                    <div class="alert alert-info mb-0 py-2">
                      <i class="bi bi-calculator"></i>
                      <small class="text-muted">üí° Birlik foyda:</small>
                      <strong id="profitPreview" style="margin-left: 10px;">0 UZS</strong>
                    </div>
                  </div>

                  <!-- STOCK -->
                  <div class="col-md-12 mb-3">
                    <label class="font-weight-bold">Miqdori *</label>
                    <div class="d-flex gap-2">
                      <input type="number" id="productStock" class="form-control" required placeholder="100" min="0">
                      <select id="productUnit" class="form-control" style="max-width:120px">
                        <option value="ta">dona</option>
                        <option value="kg">kg</option>
                      </select>
                    </div>
                  </div>
                </div>
              </div>

              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">
                  Bekor qilish
                </button>
                <button type="submit" class="btn btn-success">
                  <i class="bi bi-check-circle"></i> Saqlash
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>


      <!-- CATEGORY MODAL -->
      <div class="modal fade" id="categoryModal">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">

            <div class="modal-header">
              <h5 class="modal-title">Category Manager</h5>
              <button class="close" data-dismiss="modal">&times;</button>
            </div>

            <div class="modal-body">

              <!-- Category list -->
              <select id="categoryList" class="form-control mb-3"></select>

              <!-- New / Edit name -->
              <input id="newCategory" class="form-control" placeholder="Category name" />

            </div>

            <div class="modal-footer d-flex justify-content-between">
              <div>
                <button class="btn btn-danger btn-sm" id="deleteCategory">
                  Delete
                </button>
              </div>

              <div>
                <button class="btn btn-secondary btn-sm" id="updateCategory">
                  Update
                </button>
                <button class="btn btn-info btn-sm" id="saveCategory">
                  Add
                </button>
              </div>
            </div>

          </div>
        </div>
      </div>
    </main>
  </div>
  <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script> -->
  <script src="auth.js" defer></script>
  <script src="index.js" defer></script>
  <script src="script.js" defer></script>
  <!-- <script>
    (function () { if (document.readyState === 'loading') { document.addEventListener('DOMContentLoaded', function () { setTimeout(function () { AuthSystem.protectPage(); }, 100); }); } else { setTimeout(function () { AuthSystem.protectPage(); }, 100); } })();
  </script> -->
  <!-- JQUERY (SHART) -->
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" defer></script>
  <!-- POPPER (BOOTSTRAP 4 UCHUN) -->
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" defer></script>
  <!-- BOOTSTRAP JS -->
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>

</body>

</html>